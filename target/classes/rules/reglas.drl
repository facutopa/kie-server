/**
 * Sistema de Puntuación para Diagnóstico de Porfiria
 * 
 * Basado en las reglas médicas específicas para evaluación de Porfiria
 * con sistema de puntuación por categorías clínicas.
 */

package com.example.droolsserver.rules;
dialect "java"

import java.util.List;
import java.util.ArrayList;
import com.example.droolsserver.model.Patient;
import com.example.droolsserver.model.QuestionnaireResponse;
import com.example.droolsserver.model.CuadroClinico;
import com.example.droolsserver.model.DiagnosticoTemprano;
import com.example.droolsserver.model.GenerarOrden;
import com.example.droolsserver.model.InformarWeb;
import com.example.droolsserver.model.Recommendation;

// Los tipos están definidos en las clases Java, no necesitamos declararlos aquí

// REG-000: Inicializar Cuadro Clínico y DiagnosticoTemprano
rule "REG-000 - Inicializar Cuadro Clínico"
    when
        $patient: Patient()
        not CuadroClinico(patientId == $patient.id)
    then
        CuadroClinico cuadro = new CuadroClinico();
        cuadro.setPatientId($patient.getId());
        cuadro.setSintomasCutanea(0.0);
        cuadro.setSintomasAguda(0.0);
        cuadro.setAnamnesis(0.0);
        insert(cuadro);
        DiagnosticoTemprano diagnostico = new DiagnosticoTemprano();
        diagnostico.setPatientId($patient.getId());
        diagnostico.setSintomaCutanea(false);
        diagnostico.setSintomaAguda(false);
        insert(diagnostico);
end

// ========================================
// REGLAS DE PUNTUACIÓN - SÍNTOMAS CUTÁNEOS
// ========================================

// REG-001: Máculas (+2 puntos)
rule "REG-001 - Máculas"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "maculas", answer == "SI" )
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 2;
		$cuadro.setSintomasCutanea(nuevosPuntos);
		insert($cuadro);
end

// REG-002: Fragilidad Cutánea (+5 puntos)
rule "REG-002 - Fragilidad Cutánea"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "fragilidadCutanea", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 5;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end

// REG-003: Hipertricosis (+4 puntos)
rule "REG-003 - Hipertricosis"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "hipertricosis", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 4;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end

// REG-004: Nódulos (+1 punto)
rule "REG-004 - Nódulos"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "nodulos", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 1;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end

// REG-005: Lesiones Oculares (+1 punto)
rule "REG-005 - Lesiones Oculares"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "lesionesOculares", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 1;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end

// REG-006: Costras (+3 puntos)
rule "REG-006 - Costras"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "costras", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 3;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end

// REG-007: Quistes de Milia (+3 puntos)
rule "REG-007 - Quistes de Milia"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "quistesMilia", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 3;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end

// REG-008: Hiperpigmentación (+5 puntos)
rule "REG-008 - Hiperpigmentación"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "hiperpigmentacion", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 5;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end

// REG-009: Ampollas (+5 puntos)
rule "REG-009 - Ampollas"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "ampollas", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 5;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end

// REG-010: Fotosensibilidad (+5 puntos)
rule "REG-010 - Fotosensibilidad"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "fotosensibilidad", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 5;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end

// REG-011: Pruritos (+2 puntos)
rule "REG-011 - Pruritos"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "pruritos", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 2;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end

// REG-012: Tricosis (+3 puntos)
rule "REG-012 - Tricosis"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "tricosis", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 3;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end

// ========================================
// REGLAS DE PUNTUACIÓN - SÍNTOMAS AGUDOS
// ========================================

// REG-013: Trastornos Psiquiátricos (+4 puntos)
rule "REG-013 - Trastornos Psiquiátricos"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "trastornosPsiquiatricos", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 4;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-014: Parestesias (+5 puntos)
rule "REG-014 - Parestesias"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "parestesias", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 5;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-015: Cefaleas (+3 puntos)
rule "REG-015 - Cefaleas"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "cefaleas", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 3;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-016: Paresia (+5 puntos)
rule "REG-016 - Paresia"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "paresia", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 5;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-017: Convulsiones (+3 puntos)
rule "REG-017 - Convulsiones"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "convulsiones", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 3;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-018: Trastornos Abdominales (+5 puntos)
rule "REG-018 - Trastornos Abdominales"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "trastornosAbdominales", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 5;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-019: Síndrome Ácido Sensitivo (+2 puntos)
rule "REG-019 - Síndrome Ácido Sensitivo"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "sindromeAcidoSensitivo", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 2;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-020: Palpitaciones (+3 puntos)
rule "REG-020 - Palpitaciones"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "palpitaciones", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 3;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-021: Anorexia (+2 puntos)
rule "REG-021 - Anorexia"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "anorexia", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 2;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-022: Estrés (+5 puntos)
rule "REG-022 - Estrés"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "estres", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 5;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-023: Trastornos Neurológicos (+4 puntos)
rule "REG-023 - Trastornos Neurológicos"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "trastornosNeurologicos", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 4;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-024: Dolores Musculares (+3 puntos)
rule "REG-024 - Dolores Musculares"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "doloresMusculares", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 3;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-025: Mareos (+3 puntos)
rule "REG-025 - Mareos"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "mareos", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 3;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-026: Parálisis (+4 puntos)
rule "REG-026 - Parálisis"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "paralisis", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 4;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-027: Dolor Abdominal/Lumbar (+5 puntos)
rule "REG-027 - Dolor Abdominal/Lumbar"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "dolorAbdominalLumbar", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 5;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-028: Constipación (+3 puntos)
rule "REG-028 - Constipación"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "constipacion", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 3;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-029: Astenia (+4 puntos)
rule "REG-029 - Astenia"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "astenia", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 4;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// ========================================
// REGLAS DE PUNTUACIÓN - ANAMNESIS
// ========================================

// REG-030: Color Orina Oscura/Ámbar (+5 puntos)
rule "REG-030 - Color Orina Oscura/Ámbar"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "colorOrina", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getAnamnesis() + 5;
        $cuadro.setAnamnesis(nuevosPuntos);
        update($cuadro);
end

// REG-031: Familiares (+5 puntos)
rule "REG-031 - Familiares"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "familiares", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getAnamnesis() + 5;
        $cuadro.setAnamnesis(nuevosPuntos);
        update($cuadro);
end

// REG-032: Diabetes (+0.5 puntos)
rule "REG-032 - Diabetes"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "diabetes", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getAnamnesis() + 0.5;
        $cuadro.setAnamnesis(nuevosPuntos);
        update($cuadro);
end

// REG-033: HTA (+0.5 puntos)
rule "REG-033 - HTA"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "hta", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getAnamnesis() + 0.5;
        $cuadro.setAnamnesis(nuevosPuntos);
        update($cuadro);
end

// REG-034: Tiroides (+0.5 puntos)
rule "REG-034 - Tiroides"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "tiroides", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getAnamnesis() + 0.5;
        $cuadro.setAnamnesis(nuevosPuntos);
        update($cuadro);
end

// REG-035: Celiaquía (+0.5 puntos)
rule "REG-035 - Celiaquía"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "celiaquia", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getAnamnesis() + 0.5;
        $cuadro.setAnamnesis(nuevosPuntos);
        update($cuadro);
end

// REG-036: Lupus (+0.5 puntos)
rule "REG-036 - Lupus"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "lupus", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getAnamnesis() + 0.5;
        $cuadro.setAnamnesis(nuevosPuntos);
        update($cuadro);
end

// REG-037: Operaciones (+1 punto a síntomas cutáneos)
rule "REG-037 - Operaciones"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "operaciones", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 1;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end

// REG-038: Contacto Policlorados (+1 punto a síntomas cutáneos)
rule "REG-038 - Contacto Policlorados"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "contactoPoliclorados", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 1;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end

// REG-039: Contacto Otras Drogas (+1 punto a síntomas cutáneos)
rule "REG-039 - Contacto Otras Drogas"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "contactoOtrasDrogas", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 1;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end

// REG-040: Contacto Plomo (+0.5 puntos a síntomas agudos)
rule "REG-040 - Contacto Plomo"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "contactoPlomo", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 0.5;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-041: Contacto Otros Metales (+0.5 puntos a síntomas agudos)
rule "REG-041 - Contacto Otros Metales"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "contactoOtrosMetales", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 0.5;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-042: Cercanía Fábrica (+1 punto a síntomas cutáneos)
rule "REG-042 - Cercanía Fábrica"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "cercaniaFabrica", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 1;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end

// REG-043: Contacto Veneno (+1 punto a síntomas cutáneos)
rule "REG-043 - Contacto Veneno"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "contactoVeneno", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 1;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end

// REG-044: Contacto Derivado Petróleo (+1 punto a síntomas cutáneos)
rule "REG-044 - Contacto Derivado Petróleo"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "contactoDerivadoPetroleo", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 1;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end

// REG-045: Consume Alcohol (+5 puntos a anamnesis)
rule "REG-045 - Consume Alcohol"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "consumeAlcohol", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getAnamnesis() + 5;
        $cuadro.setAnamnesis(nuevosPuntos);
        update($cuadro);
end

// REG-046: Fuma (+2 puntos a anamnesis)
rule "REG-046 - Fuma"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "fuma", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getAnamnesis() + 2;
        $cuadro.setAnamnesis(nuevosPuntos);
        update($cuadro);
end

// REG-047: Barbitúricos (+5 puntos a síntomas agudos)
rule "REG-047 - Barbitúricos"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "barbituricos", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 5;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// REG-048: Medicamentos Hormonas (+5 puntos a anamnesis)
rule "REG-048 - Medicamentos Hormonas"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "medicamentosHormonas", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getAnamnesis() + 5;
        $cuadro.setAnamnesis(nuevosPuntos);
        update($cuadro);
end

// REG-049: Anomalías Períodos Menstruales (+4 puntos a síntomas agudos)
rule "REG-049 - Anomalías Períodos Menstruales"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "anomaliasPeriodosMenstruales", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 4;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end

// ========================================
// REGLAS DE DIAGNÓSTICO
// ========================================

// REG-052: Determinar sintomatología Aguda (>= 36 puntos OR anamnesis >= 12)
rule "REG-052 - Determinar Sintomatología Aguda"
    when
        $patient: Patient()
        $diagnostico: DiagnosticoTemprano(patientId == $patient.id)
        $cuadro: CuadroClinico(patientId == $patient.id, $cuadro.getSintomasAguda() >= 36 || $cuadro.getAnamnesis() >= 12)
    then
        $diagnostico.setSintomaCutanea(false);
        $diagnostico.setSintomaAguda(true);
        update($diagnostico);
end

// REG-053: Determinar sintomatología Cutánea (>= 22 puntos OR anamnesis >= 12)
rule "REG-053 - Determinar Sintomatología Cutánea"
    when
        $patient: Patient()
        $diagnostico: DiagnosticoTemprano(patientId == $patient.id)
        $cuadro: CuadroClinico(patientId == $patient.id, $cuadro.getSintomasCutanea() >= 22 || $cuadro.getAnamnesis() >= 12)
    then
        $diagnostico.setSintomaCutanea(true);
        $diagnostico.setSintomaAguda(false);
        update($diagnostico);
end

// ========================================
// REGLAS DE ORDENES DE ESTUDIOS
// ========================================

// REG-054: Ordenar estudios
rule "REG-054 - Ordenar Estudios"
    when
        $patient: Patient()
        $diagnostico: DiagnosticoTemprano(patientId == $patient.id, sintomaAguda == true || sintomaCutanea == true)
        not GenerarOrden(patientId == $patient.id)
    then   
        GenerarOrden orden = new GenerarOrden();
        orden.setPatientId($patient.getId());
        orden.setEstudios(true);
        insert(orden);
end


// ========================================
// REGLAS DE MEDICAMENTOS CONTRAPRODUCENTES
// ========================================

// REG-055: Informar Medicamentos Contraproducentes
rule "REG-056 - Informar Medicamentos Contraproducentes"
    when
        $patient: Patient()
        $diagnostico: DiagnosticoTemprano(patientId == $patient.id, sintomaAguda == true)
    then
        InformarWeb informar = new InformarWeb();
        informar.setPatientId($patient.getId());
        informar.setMedicamentos(true);
        insert(informar);
end
