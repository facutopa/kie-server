# 6.2.3.1 Ejemplos de Implementación de Reglas

## 6.2.3.1.1 Ejemplo de Regla de Síntomas Cutáneos

Siguiendo el formato del ejemplo de la compañera, se presenta la implementación de una regla específica para evaluación de síntomas cutáneos en el sistema de diagnóstico de porfiria.

### Figura 6.15 - Ejemplo de Creación de Regla Cutánea

```java
/*
 * REG-010
 * Categoría: Síntomas Cutáneos
 * Síntoma: Fotosensibilidad
 * Puntuación: +5 puntos
 */
rule "REG-010 - Fotosensibilidad"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "fotosensibilidad", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasCutanea() + 5;
        $cuadro.setSintomasCutanea(nuevosPuntos);
        update($cuadro);
end
```

**Explicación del código:**
- **Comentario de identificación**: `REG-010` identifica únicamente esta regla
- **Nombre de la regla**: `"REG-010 - Fotosensibilidad"` describe la funcionalidad específica
- **Condiciones (when)**: 
  - `$patient: Patient()`: Obtiene la instancia del paciente
  - `$cuadro: CuadroClinico(patientId == $patient.id)`: Obtiene el cuadro clínico del paciente
  - `$response: QuestionnaireResponse(questionId == "fotosensibilidad", answer == "SI")`: Verifica si el paciente presenta fotosensibilidad
- **Acciones (then)**:
  - Calcula nuevos puntos sumando 5 al total de síntomas cutáneos
  - Actualiza el cuadro clínico con la nueva puntuación
  - Actualiza el objeto en la base de hechos

## 6.2.3.1.2 Ejemplo de Regla de Síntomas Agudos

### Figura 6.16 - Ejemplo de Creación de Regla Aguda

```java
/*
 * REG-014
 * Categoría: Síntomas Agudos
 * Síntoma: Parestesias
 * Puntuación: +5 puntos
 */
rule "REG-014 - Parestesias"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "parestesias", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getSintomasAguda() + 5;
        $cuadro.setSintomasAguda(nuevosPuntos);
        update($cuadro);
end
```

**Explicación del código:**
- **Identificación**: `REG-014` para síntomas agudos
- **Condición específica**: Evalúa la presencia de parestesias (hormigueo, entumecimiento)
- **Puntuación alta**: +5 puntos por ser un síntoma altamente específico de porfiria aguda
- **Actualización**: Modifica la puntuación de síntomas agudos en el cuadro clínico

## 6.2.3.1.3 Ejemplo de Regla de Anamnesis

### Figura 6.17 - Ejemplo de Creación de Regla de Anamnesis

```java
/*
 * REG-031
 * Categoría: Anamnesis
 * Factor: Antecedentes Familiares
 * Puntuación: +5 puntos
 */
rule "REG-031 - Familiares"
    when
        $patient: Patient()
        $cuadro: CuadroClinico(patientId == $patient.id)
        $response: QuestionnaireResponse(questionId == "familiares", answer == "SI")
    then
        double nuevosPuntos = $cuadro.getAnamnesis() + 5;
        $cuadro.setAnamnesis(nuevosPuntos);
        update($cuadro);
end
```

**Explicación del código:**
- **Factor de riesgo**: Evalúa antecedentes familiares de porfiria
- **Alta puntuación**: +5 puntos por ser un factor de riesgo muy relevante
- **Herencia**: La porfiria tiene componente hereditario importante

## 6.2.3.1.4 Ejemplo de Regla de Diagnóstico

### Figura 6.18 - Ejemplo de Regla de Determinación de Sintomatología

```java
/*
 * REG-050
 * Categoría: Diagnóstico
 * Función: Determinar Sintomatología Aguda
 * Umbral: ≥ 36 puntos
 */
rule "REG-050 - Determinar Sintomatología Aguda"
    when
        $patient: Patient()
        $diagnostico: DiagnosticoTemprano(patientId == $patient.id)
        $cuadro: CuadroClinico(patientId == $patient.id, $cuadro.getSintomasAguda() >= 36)
    then
        $diagnostico.setSintomaCutanea(false);
        $diagnostico.setSintomaAguda(true);
        update($diagnostico);
end
```

**Explicación del código:**
- **Umbral diagnóstico**: Se activa cuando la puntuación de síntomas agudos ≥ 36
- **Diagnóstico diferencial**: Establece que NO es sintomatología cutánea
- **Confirmación**: Establece que SÍ es sintomatología aguda
- **Actualización**: Modifica el objeto de diagnóstico temprano

## 6.2.3.1.5 Ejemplo de Regla de Generación de Órdenes

### Figura 6.19 - Ejemplo de Regla de Generación de Órdenes

```java
/*
 * REG-052
 * Categoría: Órdenes
 * Función: Generar Orden de Estudios
 * Condición: Sintomatología detectada
 */
rule "REG-052 - Ordenar Estudios"
    when
        $patient: Patient()
        $diagnostico: DiagnosticoTemprano(patientId == $patient.id, sintomaAguda == true || sintomaCutanea == true)
        not GenerarOrden(patientId == $patient.id)
    then   
        GenerarOrden orden = new GenerarOrden();
        orden.setPatientId($patient.getId());
        orden.setEstudios(true);
        insert(orden);
end
```

**Explicación del código:**
- **Condición compuesta**: Se activa si hay sintomatología aguda O cutánea
- **Prevención de duplicados**: `not GenerarOrden(patientId == $patient.id)` evita órdenes múltiples
- **Creación de objeto**: Instancia nueva orden de estudios
- **Inserción**: Agrega la orden a la base de hechos

## 6.2.3.1.6 Ejemplo de Regla de Medicamentos Contraproducentes

### Figura 6.20 - Ejemplo de Regla de Medicamentos

```java
/*
 * REG-053
 * Categoría: Medicamentos
 * Función: Informar Medicamentos Contraproducentes
 * Condición: Sintomatología aguda detectada
 */
rule "REG-053 - Informar Medicamentos Contraproducentes"
    when
        $patient: Patient()
        $diagnostico: DiagnosticoTemprano(patientId == $patient.id, sintomaAguda == true)
    then
        InformarWeb informar = new InformarWeb();
        informar.setPatientId($patient.getId());
        informar.setMedicamentos(true);
        insert(informar);
end
```

**Explicación del código:**
- **Condición específica**: Solo se activa con sintomatología aguda
- **Seguridad del paciente**: Informa sobre medicamentos que pueden agravar la porfiria
- **Objeto de información**: Crea objeto para informar al paciente y médico

## 6.2.3.1.7 Comparación con el Ejemplo de la Compañera

### Similitudes con el Sistema de Ejercicios:

1. **Estructura modular**: Ambos sistemas dividen las reglas por categorías
2. **Identificación única**: Cada regla tiene un identificador (REG-XXX)
3. **Métodos específicos**: Cada regla tiene una función específica
4. **Parámetros de entrada**: Reciben objetos de dominio (Patient vs Persona)
5. **Actualización de estado**: Modifican objetos de seguimiento (CuadroClinico vs ejerciciosPermitidos)

### Diferencias específicas:

1. **Dominio médico**: El sistema de porfiria evalúa síntomas vs ejercicios
2. **Sistema de puntuación**: Puntuación acumulativa vs lista de ejercicios permitidos
3. **Umbrales diagnósticos**: Criterios médicos específicos vs criterios de aptitud física
4. **Objetivos**: Diagnóstico médico vs prescripción de ejercicios

## 6.2.3.1.8 Ventajas del Diseño Implementado

1. **Trazabilidad**: Cada regla puede ser rastreada individualmente
2. **Mantenibilidad**: Modificaciones independientes por categoría
3. **Escalabilidad**: Nuevas reglas pueden agregarse sin afectar las existentes
4. **Auditabilidad**: Sistema permite auditoría completa de decisiones
5. **Flexibilidad**: Umbrales y puntuaciones ajustables según evidencia médica
